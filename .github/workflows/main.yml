# Nome do Workflow no GitHub
name: FraudDetection CI/CD Pipeline

# Gatilho
on:
  push:
    branches: 
      - '**'        # Rodar em TODAS as branches (incluindo sub-pastas)
  pull_request:
    branches: 
      - main        # Rodar testes quando tentar mesclar algo na main

# Jobs
jobs:
  quality-assurance:
    runs-on: ubuntu-latest # Máquina Linux gratuita do GitHub

    steps:
    - name: 1. Baixar o Código
      uses: actions/checkout@v3

    - name: 2. Configurar Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: 3. Instalar Dependências
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest httpx # Ferramentas de teste

    - name: 4. Lint com Ruff
      run: |
        pip install ruff
        ruff check .

    - name: 5. Rodar Testes Unitários e de Integração
      env:
        # Essa variável será substituída pelo valor secreto salvo em:
        # repositório > Settings > Secrets and variables > Actions
        API_KEY: ${{ secrets.API_KEY }} 
      run: |
        pytest tests/

    - name: 6. Validar Build do Docker # Verificar se o Dockerfile criado continua funcionando
      run: |
        docker build -t fraud-app-test .